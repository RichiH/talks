\documentclass[t]{beamer}
\usepackage{helvet}
\usepackage{calc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usetheme{Ilmenau}

\setbeamercovered{transparent}
\setbeamertemplate{navigation symbols}{}

\usepackage{units}
\usepackage{amsbsy}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{epsf}
\usepackage{epsfig}
\usepackage{fixmath}
%\usepackage{pgfmath}
\usepackage{wrapfig}


\title{Adapting brownfield technology to cloud-native technology}
\subtitle{One year of Prometheus}
\author{Richard Hartmann,\\
RichiH@\{freenode,OFTC,IRCnet\},\\
richih@\{fosdem,debian,richih\}.org}
\date{2016-11-09}


\begin{document}

% hide all subsections
\setcounter{tocdepth}{1}

\begin{frame}
	\titlepage
\end{frame}

%\begin{frame}
%	\frametitle{Statistics}
%	\tableofcontents
%\end{frame}

\section{Introduction}

\begin{frame}
	\frametitle{`whoami`}
	\begin{itemize}
		\item Richard "RichiH" Hartmann
		\item System architect at SpaceNet AG
		\item Always looking for nice co-workers in the Munich area ;)
		\item FOSDEM, DebConf, DENOGx, PromCon staff
		\item Debian Developer
		\item Author of \url{https://github.com/RichiH/vcsh}
	\end{itemize}
\end{frame}

\section{Background}

\begin{frame}
	\frametitle{`whowasi`}
	\begin{itemize}
		\item 2009-2015: Solely responsible for a Germany-wide backbone's
		\begin{itemize}
			\item Architecture
			\item Purchasing
			\item Operations
			\item ...and On-Call for 24 * 365 * 7 hours
		\end{itemize}
		\item Literally, my sanity depended on aggressive yet correct monitoring \& alerting
		\item Love monitoring, but hate (almost) all monitoring tools
		\item Used Zabbix exclusively
		\item (New guy pushed Cacti and got approval; a good time to leave)
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{SpaceNet}
	\begin{itemize}
		\item SpaceNet is the oldest commercial ISP in Germany; operating since 1993
		\item Lots of legacy, in-house solutions for monitoring, config management, orchestration, etc which predate everything else
		\item One company-wide monitoring solution: watchdog \& watchcat
		\item Technically sound, but alerting done through B52-style email carpet bombing
		\item Yet, every team has its own custom tools on top
		\item Quality dependent on team
		\item Islands of data; no APIs, no machine-readable export
	\end{itemize}
\end{frame}


% money is made with brownfield so you need to make sure there is no impact
  % lots of overlap until new stuff gains trust
  % mail server farm incident
    % buy-in
  % people's motivation is to resist change; and that's OK until the system can actually handle change
  % most will readily agree that the new approach is better, but they fear the way there
    % ideally, we should magic from zero to done without anyone noticing


% 

\section{Lightbringer}

\begin{frame}
	\frametitle{Seeing the light}
	\begin{itemize}
		\item Ran DebConf15 on LibreNMS, wanted to do the same for FOSDEM
		\item 2015-10-01: Inform FOSDEM team of planned migration
		\item 2015-10-02: Murali Suriar suggests Prometheus instead
		\item 2015-10-03: First trivial patch
	\end{itemize}
\end{frame}

\subsection{Technical}

\begin{frame}
	% TODO
	\frametitle{Here, there be network}
	\begin{itemize}
		\item We are an ISP, remember?
		\item ~1000 devices polled via SNMP
		\item Might be the world's largest snmp\_exporter installation
		\item Python implementation of smnp\_exporter had really bad system load
		\begin{itemize}
			\item It goes up to eleven...
			\item ~60 devices outof ~300 at the time were up/down
			\item The set of affected devices was stable
		\end{itemize}
		\item Contracted Brian Brazil to reimplement in Go
		\item Go implementation hit some unexpected pitfalls of various SNMP implementations
		\begin{itemize}
			\item Some data structures returned repeatedly
			\item Table indices returned repeatedly
			\item Table indices emtpy
		\end{itemize}
			% todo new page "open / todo"?
		\item Go implementation errors out completely on such errors, thus using Python exporter for some machine sets for now
		\item Caveat: Ip4Table %TODO broken in Python implementation
		\item IOS XR uses non-standard mapping for CPU %TODO load/temp? and others; descriptive language of snmp\_exporter does not suffice
	\end{itemize}
\end{frame}


\begin{frame}
	\frametitle{That one mailserver incident...}
	\begin{itemize}
		\item Wrong flag in config
		\item One server accepting outside mail
		\item Spammers do a clean, staggered ramp-up
		\item Once they go all-in the mail gateways come under heavy load
		\item Quote from On-Call "It took me less than 30 seconds to figure out the problem; with our old system it would have taken 5-15 minutes"
		\item ...and all of a sudden, you have buy-in from a few more people
	\end{itemize}
\end{frame}

\subsection{Money}

\begin{frame}
	\frametitle{The biggest challenge}
	\begin{itemize}
		\item In brownfield, revenue comes from legacy systems
		\item 
	\end{itemize}
\end{frame}

\subsection{Social}

\begin{frame}
	\frametitle{The biggest challenge}
	\begin{itemize}
		\item Incentives often run counter to change
		\item 
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Perspective}
	\begin{itemize}
		\item Tell everyone what they need to hear (but never lie)
		\item Managers care about revenue and %TODO
		\item 
	\end{itemize}
\end{frame}

% operations stakeholders fear change
  % they get paid to keep the current system up and running, not to increase change
  % error budgets
% https://cnkc16.sched.org/mobile/#session:9c50e61854e3ba8b9bbc5de3d1a5dbca
%Dashboard
%Perpetual greenfield
%One tool fits all
%Make your hammer fit your nails

% social (windows)

% sales
% accounting
% power count

% are we there yet? no!
% highly fractured, remember? Still, kubernetes operators sound extremely nice
% finding the correct balance can be tricky

%Know of UPS / core link downtime within less than 30 seconds, but no false positives

%Goals / that's obvious section?

%Current state NOW, not five minutes ago (but info)
%Important later, during daytime
%Make sure tickets are opened so we can postmortem all the things

%Push vs pull not a conceptual problem due to watchdog
%  Concept of scraping new
%Watchdog can do logic checks, regexp etc; not only metrics
%

%Snmp Kill wenn zu oft auf alte Devices
%Wollen ewiges Storage
%Immer noch zwei große Prom, Teams noch nicht so weit.
%Want USV in seconds, Mail Accounting reicht täglich
%Not invented here
%  Anyone can Design Encryption they CAN'T Break; or Monitoring they CAN'T improve any more
%Too much work to install agent as no central role-out(wollen wir das?)
%Big Picture for management, button from top, middle management and key technical architects
%  Different parts of the picture for different people and languages
%  Anyone can talk to an engineer about a UPS for two hours, but management...
%One tool fits all departments
%Autogen PDF reports
%  Buy-in from service management
%Give them what they want/play to their intrinsic motivation
%Do not lie
%If no motivation, escalate

%Error budgets as a long-term goal
%Toil in too many places
%Push vs pull not a conceptual problem due to watchdog
%  Concept of scraping new
%Watchdog can do logic checks, regexp etc; not only metrics

%Too much "fix this now" and not learning aggressively from outages.
%Not all teams tracked and compared KPIs over time
%From plain uptime to service request success rate

%Dashboard
%Perpetual greenfield
%One tool fits all
%Make your hammer fit your nails



\section{Outro}

\begin{frame}
	\frametitle{Thanks!}
		\begin{center}
			\vfill
			Thanks for listening!\\
			\vfill
			Questions?
			\vfill
			See slide footer for contact information.
			\vfill
		\end{center}
\end{frame}

\end{document}

%\begin{frame}
%	\frametitle{}
%	\begin{itemize}
%		\item 
%		\item 
%		\item 
%		\item 
%		\item 
%	\end{itemize}
%\end{frame}
